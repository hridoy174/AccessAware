(()=>{var e={};function t(){var t=0;for(var s in e)t+=Object.keys(e[s]).length;t>0?(chrome.action.setBadgeText({text:t.toString()}),chrome.action.setBadgeBackgroundColor({color:"#cc0000"})):chrome.action.setBadgeText({text:""})}chrome.runtime.onMessage.addListener((function(s,o,r){if("logAccess"===s.action)return chrome.storage.local.get({logs:[],notificationsEnabled:!0,trustedSites:[],blockedSites:[]},(function(e){var t=e.logs,c=new URL(o.tab.url).hostname;if(e.trustedSites&&e.trustedSites.some((function(e){return c.includes(e)})))return t.push({url:c,resource:s.resource,timestamp:(new Date).toISOString(),trusted:!0}),chrome.storage.local.set({logs:t},(function(){console.log("✅ Log saved for trusted site:",c)})),void r({status:"trusted-site"});if(e.blockedSites&&e.blockedSites.some((function(e){return c.includes(e)})))return t.push({url:c,resource:s.resource,timestamp:(new Date).toISOString(),blocked:!0}),chrome.storage.local.set({logs:t},(function(){console.log("⛔ Blocked access attempt logged for:",c)})),chrome.notifications.create({type:"basic",iconUrl:"assets/icons/128.png",title:"AccessAware - Access Blocked",message:"Blocked ".concat(c," from accessing your ").concat(s.resource,"!"),priority:2}),void r({status:"blocked-site"});var a=t[t.length-1];a&&a.url===c&&a.resource===s.resource&&new Date-new Date(a.timestamp)<6e4?r({status:"ignored-duplicate"}):(t.push({url:c,resource:s.resource,timestamp:(new Date).toISOString()}),chrome.storage.local.set({logs:t},(function(){console.log("✅ Log saved successfully:",t)})),e.notificationsEnabled&&chrome.notifications.create({type:"basic",iconUrl:"assets/icons/128.png",title:"AccessAware Alert",message:"".concat(c," is accessing your ").concat(s.resource,"!"),priority:2}),r({status:"received"}))})),!0;if("getActiveStreams"===s.action)return r({activeStreams:e}),!0;if("streamActive"===s.action){var c=new URL(o.tab.url).hostname;return e[c]||(e[c]={}),e[c][s.streamId]={resource:s.resource,startTime:(new Date).toISOString(),tabId:o.tab.id},t(),r({status:"stream-active"}),!0}if("streamEnded"===s.action){var a=new URL(o.tab.url).hostname;if(e[a]&&e[a][s.streamId]){var n=new Date(e[a][s.streamId].startTime),i=new Date,u=i-n,l=Math.round(u/6e4);chrome.storage.local.get({logs:[]},(function(t){var o=t.logs;o.push({url:a,resource:e[a][s.streamId].resource,timestamp:i.toISOString(),duration:l,type:"session-end"}),chrome.storage.local.set({logs:o})})),delete e[a][s.streamId],0===Object.keys(e[a]).length&&delete e[a],t()}return r({status:"stream-ended"}),!0}}))})();